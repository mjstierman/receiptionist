{% extends "layout.html" %}

{% block title %} Manage Receipts {% endblock %}

{% block main %}

<html lang="en">
    <body>
        <div class="header">
            <h1>Receipts</h1>
        </div>
        <div class="container-fluid" style="display: flex; gap: 50px;">
            <div class="col-mb-1" style="max-width: 400px">
                <h2>Update Receipt</h2>
                <form action="/receipts" method="POST" enctype="multipart/form-data">
                    <select name="id" class="form-select" aria-label="Select Receipt ID">
                        <option value="" selected>New Receipt</option>
                        <option value="" disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
                        {% for receipt in receipts %}
                            <option value="{{ receipt['id'] }}">{{ receipt['id'] }}</option>
                        {% endfor %}
                    </select><br>
                    <select name="merchant" class="form-select" aria-label="Select Merchant" required>
                        <option value="" disabled selected>Select Merchant</option>
                        {% for merchant in merchants %}
                            <option value="{{ merchant['id'] }}">{{ merchant['name'] }}</option>
                        {% endfor %}
                    </select><br>
                    <select name="location" class="form-select" aria-label="Select Location" required>
                        <option value="" disabled selected>Select Location</option>
                        {% for address in addresses %}
                            <option value="{{ address['id'] }}">{{ address['name'] }}</option>
                        {% endfor %}
                    </select><br>
                    <select name="category" class="form-select" aria-label="Select Category"required>
                        <option value="" disabled selected>Select Category</option>
                        {% for category in categories %}
                            <option value="{{ category['id'] }}">{{ category['name'] }}</option>
                        {% endfor %}
                    </select><br>
                    <input name="tags" placeholder="tags" type="text"><br>
                    <input name="items" placeholder="items" type="text"><br>
                    <div class="input-group mb-3">
                        <span class="input-group-text">{{ currency_symbol }}</span>
                        <input name="amount" placeholder="amount" type="number" step="0.01" required><br>
                    </div>
                    <input type="checkbox" class="form-check-input" name="income" value="1"> Income<br>
                    <select name="account" class="form-select" aria-label="Select Account" required>
                        <option value="" disabled selected>Select Account</option>
                        {% for account in accounts %}
                            <option value="{{ account['id'] }}">{{ account['name'] }}</option>
                        {% endfor %}
                    </select><br>
                    <input name="datetime" placeholder="date" type="datetime-local" required><br>
                    <select name="timezone" class="form-select" aria-label="Select Timezone" required>
                        <option value="UTC">UTC</option>
                        <option value="US/Eastern">US/Eastern</option>
                        <option value="US/Central">US/Central</option>
                        <option value="US/Mountain">US/Mountain</option>
                        <option value="US/Pacific">US/Pacific</option>
                    </select><br>
                    <div>
                        <label for="file">Choose a file</label><br>
                        <input type="file" id="file" name="file" />
                    </div>
                    <button type="submit" class="btn btn-primary">Update Receipt</button><br>
                </form>
            </div>

            <div class="section">

                <h2>All Receipts</h2>
                <table class="table table-striped table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">id</th>
                            <th scope="col">Date</th>
                            <th scope="col">Category</th>
                            <th scope="col">Tags</th>
                            <th scope="col">Items</th>
                            <th scope="col">Merchant</th>
                            <th scope="col">Location</th>
                            <th scope="col">Account</th>
                            <th scope="col">Amount</th>
                            <th scope="col">Image</th>
                            <th scope="col">Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for receipt in receipts %}
                            <tr>
                                <td data-id="{{ receipt['id'] }}">{{ receipt['id'] }}</td>
                                <td data-id="{{ receipt['date'] }}">{{ receipt['date'] }}</td>
                                <td>{{ receipt['category'] }}</td>
                                <td>{{ receipt['tags'] }}</td>
                                <td>{{ receipt['items'] }}</td>
                                <td>{{ receipt['merchant'] }}</td>
                                <td>{{ receipt['location'] }}</td>
                                <td>{{ receipt['account'] }}</td>
                                <td>
                                    {% if receipt['income'] %}
                                        <p style="color: green;">{{ receipt['amount'] }}</p>
                                    {% else %}
                                        <p style="color: black;">{{ receipt['amount'] }}</p>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if receipt['image'] %}
                                        <a href="/receipt_image/{{ receipt['id'] }}" target="_blank">ðŸ“„</a>
                                    {% endif %}
                                </td>
                                <td><form action="/receipts" method="POST" name="delete">
                                        <div>
                                            <button name="delete" class="btn btn-primary" value="{{ receipt['id']}}">X
                                        </div>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </body>
{% endblock %}
